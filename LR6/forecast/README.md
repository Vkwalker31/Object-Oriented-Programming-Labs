# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ6: Dependency Injection –∏ TDD.

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤, –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ Test-Driven Development (TDD).

---
# Weather Forecast API

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö (OpenWeather, Google Weather API). –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ GRASP, –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ GoF, Dependency Injection –∏ TDD.

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[Swagger UI](http://localhost:8080/swagger/index.html)** ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
- **[OpenWeather API](https://openweathermap.org/api)** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- **[Google Weather API](https://weather.googleapis.com)** ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤)
swag init -g main.go -o ./api/docs --parseDependency

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
go run main.go

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (–∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞ —Å go.work)
go test ./...

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
go test ./... -cover

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞ —Ç–µ—Å—Ç–æ–≤
go test ./internal/provider -v
```

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# OpenWeather –ø—Ä–æ–≤–∞–π–¥–µ—Ä
OPENWEATHER_API_KEY=a701438bafa0cae95bdba39819ca6370
OPENWEATHER_BASE_URL=https://api.openweathermap.org/data/2.5/weather

# Google Weather –ø—Ä–æ–≤–∞–π–¥–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
GOOGLE_WEATHER_API_KEY=your_google_api_key
GOOGLE_WEATHER_BASE_URL=https://weather.googleapis.com/v1

# –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
PORT=8080
```

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á:**
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [OpenWeather](https://openweathermap.org/api)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [API keys](https://home.openweathermap.org/api_keys)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Default key** –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ email
5. –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤ `.env`

---

## üì° API Endpoints

### –¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞

#### –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –≥–æ—Ä–æ–¥–∞
```http
GET /api/v1/weather?city=Minsk
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `city` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ: Minsk, London, Tokyo, Shanghai, Warsaw)
- `provider` ‚Äî –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–∞–Ω–Ω—ã—Ö, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (openweather | google)

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "temperature": -0.91,
    "feels_like": -4.91,
    "humidity": 87,
    "pressure": 1014,
    "description": "scattered clouds"
  }
}
```

#### –ü–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
```http
GET /api/v1/weather?lat=53.9&lon=27.5667
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `lat` ‚Äî —à–∏—Ä–æ—Ç–∞
- `lon` ‚Äî –¥–æ–ª–≥–æ—Ç–∞
- `provider` ‚Äî –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–∞–Ω–Ω—ã—Ö, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

---

### –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã

```http
GET /api/v1/forecast?city=London&days=3
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `city` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (lat, lon)
- `days` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø—Ä–æ–≥–Ω–æ–∑–∞ (1-10)
- `provider` ‚Äî –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–∞–Ω–Ω—ã—Ö, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "entries": [
      {
        "date": "2026-02-17",
        "temperature": 14.2,
        "humidity": 75
      },
      {
        "date": "2026-02-18",
        "temperature": 16.8,
        "humidity": 68
      },
      {
        "date": "2026-02-19",
        "temperature": 18.1,
        "humidity": 62
      }
    ]
  }
}
```

---

### –ü–∞–∫–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–æ–∫–∞—Ü–∏–π)

```http
POST /api/v1/weather/batch?provider=openweather
Content-Type: application/json

[
  {"city": "Minsk"},
  {"city": "London"},
  {"lat": "35.6762", "lon": "139.6503"}
]
```

**–û—Ç–≤–µ—Ç (200):**
```json
{
  "code": 200,
  "message": "Success",
  "data": {
    "results": [
      {
        "location": "Minsk",
        "temperature": -0.91
      },
      {
        "location": "London",
        "temperature": 8.5
      },
      {
        "location": "Tokyo",
        "temperature": 12.3
      }
    ]
  }
}
```
## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –§–∏–ª–æ—Å–æ—Ñ–∏—è TDD

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Test-Driven Development:

1. ‚úÖ **–¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –ø–µ—Ä–µ–¥ –∫–æ–¥–æ–º** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∫–æ–º–º–∏—Ç–æ–≤ —ç—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç
2. ‚úÖ **FIRST —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
    - **F**ast ‚Äî —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
    - **I**ndependent ‚Äî –∫–∞–∂–¥—ã–π —Ç–µ—Å—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º
    - **R**epeatable ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã
    - **S**elf-Validating ‚Äî —è–≤–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (pass/fail)
    - **T**imely ‚Äî –Ω–∞–ø–∏—Å–∞–Ω—ã –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –∫–æ–¥–æ–º

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
go test ./... -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
go test ./... -cover

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–∞–∫–µ—Ç
go test ./internal/service -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
go test ./internal/service -run TestGetWeather -v

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
go test ./tests/integration -v

# –¢–µ—Å—Ç—ã —Å –±–µ–Ω—á–º–∞—Ä–∫–∞–º–∏
go test ./... -bench=. -benchmem
```

**–ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞:**
```bash
go test ./... -coverprofile=coverage.out
go tool cover -html=coverage.out
```
---